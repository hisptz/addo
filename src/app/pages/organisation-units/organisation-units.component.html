<mat-tab-group>
  <mat-tab label="Addos Reporting Status">
    <ng-template matTabContent>
      <div class="row">
        <div class="col-sm-3">
          <ngx-dhis2-org-unit-filter
            [orgUnitFilterConfig]="orgUnitFilterConfig"
            (orgUnitUpdate)="onOrgUnitUpdate($event)"
            (orgUnitClose)="onOrgUnitUpdate($event)"
          >
          </ngx-dhis2-org-unit-filter>
          <ngx-dhis2-period-filter
            [periodFilterConfig]="periodFilterConfig"
            (update)="onPeriodUpdate($event, 'UPDATE')"
            (change)="onPeriodUpdate($event, 'CHANGE')"
            (close)="onPeriodUpdate($event, 'CLOSE')"
          ></ngx-dhis2-period-filter>
        </div>
        <div class="col-sm-9">
          <div class="row" *ngIf="selectedOrganisationUnitStatus$ | async">
            <mat-card class="col-sm-12 downs">
              <h4 class="header">
                Addos Reporting Status in
                {{
                  (selectedOrganisationUnit$ | async)
                    ? (selectedOrganisationUnit$ | async).name
                    : ""
                }}
                for
                {{
                  periodObject ? periodObject["items"][0].name : "Last Month"
                }}
              </h4>
              <button
                *ngIf="
                  (organisationUnitChildrenLoaded$ | async) &&
                  !(isLeafOrganisation$ | async)
                "
                class="btn btn-outline-secondary"
                (click)="downloadCSV()"
              >
                Save Excel
              </button>
            </mat-card>

            <div
              class="col-sm-12"
              [hidden]="
                !(organisationUnitChildrenLoaded$ | async) &&
                (isLeafOrganisation$ | async)
              "
            >
              <div class="div-tabl" style="margin-top: 20px;">
                <button class="btn btn-primary" (click)="showAddoStatus()">
                  Show {{ showStatus ? "Reported" : "Not Reported" }} Addos
                </button>
                <div
                  class="col-sm-5"
                  style="padding-bottom: 10px; display: flex;"
                >
                  <input
                    class="form-control"
                    type="text"
                    placeholder="Search"
                    [(ngModel)]="searchKey"
                    (keyup)="applySearch() || searchReported()"
                    style="
                      border-top: none;
                      border-left: none;
                      border-right: none;
                      border-radius: none;
                    "
                  />
                  <button
                    mat-button
                    matSuffix
                    mat-icon-button
                    aria-label="clear"
                    [hidden]="!searchKey"
                    (click)="onSearchClear()"
                  >
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
              </div>
              <div class="mat-elevation-z8" [hidden]="!showStatus">
                <mat-table [dataSource]="orgunitchildren">
                  <ng-container matColumnDef="SN">
                    <mat-header-cell *matHeaderCellDef>S/N</mat-header-cell>
                    <mat-cell *matCellDef="let child"></mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Name">
                    <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
                    <mat-cell *matCellDef="let child">{{
                      child.name
                    }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Code">
                    <mat-header-cell *matHeaderCellDef>Code</mat-header-cell>
                    <mat-cell *matCellDef="let child">{{
                      child.code ? child.code : "Missing Code"
                    }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Owner">
                    <mat-header-cell *matHeaderCellDef
                      >Owner's Contact</mat-header-cell
                    >
                    <mat-cell
                      *matCellDef="let child"
                      (click)="onEditChild($event, child)"
                      class="editchild"
                      >{{
                        child.phoneNumber
                          ? child.phoneNumber
                          : "Missing Contact Details"
                      }}</mat-cell
                    >
                  </ng-container>
                  <ng-container matColumnDef="Dispenser">
                    <mat-header-cell *matHeaderCellDef
                      >Dispenser's Contact</mat-header-cell
                    >
                    <mat-cell
                      *matCellDef="let child"
                      (click)="onEditChild($event, child)"
                      class="editchild"
                      >{{
                        child.attributeValues[0]
                          ? child.attributeValues[0].value
                          : "Missing Contact Details"
                      }}</mat-cell
                    >
                  </ng-container>
                  <ng-container matColumnDef="noData">
                    <mat-footer-cell *matFooterCellDef colspan="6"
                      >All Addos Reported ðŸ¤©</mat-footer-cell
                    >
                  </ng-container>
                  <mat-header-row
                    *matHeaderRowDef="displayColumns"
                  ></mat-header-row>
                  <mat-row
                    *matRowDef="let row; columns: displayColumns"
                  ></mat-row>
                  <mat-footer-row
                    *matFooterRowDef="['noData']"
                    [ngClass]="{ hide: orgunitchildren != null }"
                  ></mat-footer-row>
                </mat-table>
                <mat-paginator
                  [length]="orgunitchildren ? orgunitchildren.data.length : ''"
                  [pageSizeOptions]="[10, 20, 30, 40, 100]"
                  [pageSize]="30"
                  showFirstLastButtons
                ></mat-paginator>
              </div>

              <!-- Beginning of Reported Facilities-->

              <div class="mat-elevation-z8" [hidden]="showStatus">
                <mat-table [dataSource]="reportedAddos">
                  <ng-container matColumnDef="SN">
                    <mat-header-cell *matHeaderCellDef>S/N</mat-header-cell>
                    <mat-cell *matCellDef="let child"></mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Name">
                    <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
                    <mat-cell *matCellDef="let child">{{
                      child.name
                    }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Code">
                    <mat-header-cell *matHeaderCellDef>Code</mat-header-cell>
                    <mat-cell *matCellDef="let child">{{
                      child.code ? child.code : "Missing Code"
                    }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="Owner">
                    <mat-header-cell *matHeaderCellDef
                      >Owner's Contact</mat-header-cell
                    >
                    <mat-cell
                      *matCellDef="let child"
                      (click)="onEditChild($event, child)"
                      class="editchild"
                      >{{
                        child.phoneNumber
                          ? child.phoneNumber
                          : "Missing Contact Details"
                      }}</mat-cell
                    >
                  </ng-container>
                  <ng-container matColumnDef="Dispenser">
                    <mat-header-cell *matHeaderCellDef
                      >Dispenser's Contact</mat-header-cell
                    >
                    <mat-cell
                      *matCellDef="let child"
                      (click)="onEditChild($event, child)"
                      class="editchild"
                      >{{
                        child.attributeValues[0]
                          ? child.attributeValues[0].value
                          : "Missing Contact Details"
                      }}</mat-cell
                    >
                  </ng-container>
                  <ng-container matColumnDef="Update">
                    <mat-header-cell *matHeaderCellDef
                      >Last Update</mat-header-cell
                    >
                    <mat-cell *matCellDef="let child">{{
                      child.lastUpdated | date
                    }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="noData">
                    <mat-footer-cell *matFooterCellDef colspan="6"
                      >No Addo that Reported ðŸ˜¢</mat-footer-cell
                    >
                  </ng-container>
                  <mat-header-row
                    *matHeaderRowDef="showColumns"
                  ></mat-header-row>
                  <mat-row *matRowDef="let row; columns: showColumns"></mat-row>
                  <mat-footer-row
                    *matFooterRowDef="['noData']"
                    [ngClass]="{
                      hide: !(
                        reportedAddos != null && reportedAddos.data.length == 0
                      )
                    }"
                  ></mat-footer-row>
                </mat-table>
                <mat-paginator
                  [length]="reportedAddos ? reportedAddos.data.length : ''"
                  [pageSizeOptions]="[10, 20, 30, 40, 100]"
                  [pageSize]="30"
                  showFirstLastButtons
                  *ngIf
                ></mat-paginator>
              </div>

              <!--End of Reported Facilities-->
            </div>
          </div>
          <div
            *ngIf="!(organisationUnitChildrenLoaded$ | async)"
            class="col-sm-12 loader"
          >
            <img src="assets/icons/balls-3.svg" />
            <h2 class="loadSlider">
              Fetching
              {{
                (selectedOrganisationUnit$ | async)
                  ? (selectedOrganisationUnit$ | async).name
                  : ""
              }}
              Addos
            </h2>
          </div>
        </div>
      </div>
    </ng-template>
  </mat-tab>
  <mat-tab label="SMS Automation">
    <ng-template matTabContent>
      <app-sms></app-sms>
    </ng-template>
  </mat-tab>
</mat-tab-group>
